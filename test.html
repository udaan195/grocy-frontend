<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Test</title>
    <style>
        /* --- Minimal CSS for Testing --- */
        body { font-family: sans-serif; padding: 20px; }
        .product-card { border: 1px solid #ccc; padding: 15px; margin-bottom: 10px; border-radius: 8px; }
        .product-card button { background-color: #28a745; color: white; border: none; padding: 10px; cursor: pointer; }
        #cart-icon { font-size: 24px; cursor: pointer; position: fixed; top: 20px; right: 20px; }
        .cart-popup { display: none; position: fixed; right: 0; top: 0; width: 300px; height: 100%; background: white; box-shadow: -5px 0 15px rgba(0,0,0,0.2); padding: 20px; box-sizing: border-box; }
        .cart-popup.open { display: block; }
        .cart-item { border-bottom: 1px solid #eee; padding: 10px 0; }
    </style>
</head>
<body>

    <h1>Product List</h1>
    <div id="product-list">
        </div>

    <div id="cart-icon">üõí</div>

    <div id="cart-popup" class="cart-popup">
        <h2>My Cart</h2>
        <button id="close-cart-btn" style="position:absolute; top:10px; right:10px;">&times;</button>
        <div id="cart-items"></div>
        <hr>
        <strong>Total: ‚Çπ<span id="cart-total">0</span></strong>
        <button id="checkout-btn" style="width:100%; margin-top: 10px;">Proceed to Checkout</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("Test page loaded. Starting script.");
            alert("‡§ü‡•á‡§∏‡•ç‡§ü ‡§™‡•á‡§ú ‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§");

            // --- DOM Elements ---
            const productListDiv = document.getElementById('product-list');
            const cartPopup = document.getElementById('cart-popup');
            const cartIconBtn = document.getElementById('cart-icon');
            const closeCartBtn = document.getElementById('close-cart-btn');
            const cartItemsDiv = document.getElementById('cart-items');
            const cartTotalSpan = document.getElementById('cart-total');

            // --- Mock Data (‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§Ø‡§π‡•Ä‡§Ç ‡§°‡•á‡§ü‡§æ ‡§¨‡§®‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç) ---
            const allProducts = [
                { _id: 'prod1', name: 'Apple', price: 100 },
                { _id: 'prod2', name: 'Milk', price: 50 },
                { _id: 'prod3', name: 'Bread', price: 40 }
            ];
            
            let cart = JSON.parse(localStorage.getItem('test_cart')) || [];

            // --- Functions ---
            function renderProducts() {
                if (!productListDiv) return;
                allProducts.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.innerHTML = `
                        <h3>${product.name}</h3>
                        <p>‚Çπ${product.price}</p>
                        <button class="add-to-cart-btn" data-product-id="${product._id}">Add to Cart</button>
                    `;
                    productListDiv.appendChild(card);
                });
            }

            function renderCart() {
                console.log("Running renderCart with cart:", cart);
                console.log("Using this product list:", allProducts);

                if (!cartItemsDiv) return;
                cartItemsDiv.innerHTML = '';

                if (cart.length === 0) {
                    cartItemsDiv.innerHTML = '<p>Your cart is empty.</p>';
                } else {
                    cart.forEach(cartItem => {
                        const product = allProducts.find(p => p._id === cartItem.productId);
                        if (product) {
                            const itemElement = document.createElement('div');
                            itemElement.className = 'cart-item';
                            itemElement.innerHTML = `<span>${product.name} (x${cartItem.quantity})</span>`;
                            cartItemsDiv.appendChild(itemElement);
                        } else {
                             console.error(`Could not find product with ID: ${cartItem.productId}`);
                        }
                    });
                }
                const total = cart.reduce((sum, item) => {
                    const product = allProducts.find(p => p._id === item.productId);
                    return sum + (product ? product.price * item.quantity : 0);
                }, 0);
                if (cartTotalSpan) cartTotalSpan.innerText = total.toFixed(2);
            }

            function addToCart(productId) {
                const existingItem = cart.find(item => item.productId === productId);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ productId: productId, quantity: 1 });
                }
                localStorage.setItem('test_cart', JSON.stringify(cart));
                renderCart(); // ‡§ï‡§æ‡§∞‡•ç‡§ü ‡§ï‡•ã ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
            }

            // --- Event Listeners ---
            productListDiv.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-to-cart-btn')) {
                    addToCart(e.target.dataset.productId);
                }
            });

            cartIconBtn.addEventListener('click', () => {
                renderCart(); // ‡§ñ‡•ã‡§≤‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ï‡§æ‡§∞‡•ç‡§ü ‡§ï‡•ã ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç
                cartPopup.classList.add('open');
            });
            
            closeCartBtn.addEventListener('click', () => {
                cartPopup.classList.remove('open');
            });

            // --- Initial Load ---
            renderProducts();
            renderCart();
            alert("‡§∏‡§¨ ‡§ï‡•Å‡§õ ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à‡•§ ‡§Ö‡§¨ 'Add to Cart' ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§´‡§ø‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§ü ‡§Ü‡§á‡§ï‡•â‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§");
        });
    </script>

</body>
</html>
